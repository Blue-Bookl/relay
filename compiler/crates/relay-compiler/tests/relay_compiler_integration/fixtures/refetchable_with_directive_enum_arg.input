# BUG: Dependency analyzer doesn't track enum usage in @refetchable directive strings.
#
# When an enum variant is removed from the schema, the incremental build should
# detect that fragments using that variant need to be rebuilt and report an error.
# However, the dependency analyzer does not track enum usage in directive string
# arguments from @refetchable(directives: [...]), so the fragment is not rebuilt
# and the stale artifact (referencing the removed STORE_AND_NETWORK variant)
# remains in the output.
#
# Expected: Incremental build fails with "Expected a value of type 'FetchPolicy'"
# Actual: Incremental build succeeds, leaving stale artifacts.

//- foo.js
graphql`
  fragment foo on User
  @refetchable(
    queryName: "FooRefetchQuery"
    directives: ["@fetchPolicy(policy: STORE_AND_NETWORK)"]
  ) {
    id
  }
`;

//- relay.config.json
{
   "language": "typescript",
   "schema": "./schema.graphql"
}

//- schema.graphql
enum FetchPolicy { STORE_AND_NETWORK, NETWORK_ONLY }
directive @fetchPolicy(policy: FetchPolicy!) on QUERY
type Query { node(id: ID!): Node }
interface Node { id: ID! }
type User implements Node { id: ID! }

//-++ schema.graphql
# Remove the STORE_AND_NETWORK variant from the enum. This should cause the
# incremental build to fail.
enum FetchPolicy { NETWORK_ONLY }
directive @fetchPolicy(policy: FetchPolicy!) on QUERY
type Query { node(id: ID!): Node }
interface Node { id: ID! }
type User implements Node { id: ID! }
